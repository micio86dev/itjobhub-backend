FROM oven/bun:1-alpine

WORKDIR /app

# Copy only what's needed for migrations
COPY package.json bun.lock ./
COPY prisma ./prisma/
COPY prisma.config.ts ./

# Install dependencies
RUN bun install --frozen-lockfile

# Generate Prisma client (dummy DATABASE_URL for generation only)
RUN DATABASE_URL="mongodb://dummy:27017/dummy" bunx prisma generate

# Default command - for MongoDB use db push instead of migrate deploy
CMD ["bunx", "prisma", "db", "push", "--accept-data-loss"]
